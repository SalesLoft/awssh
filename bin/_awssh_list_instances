#! /usr/bin/env ruby
require "aws-sdk"

client = Aws::EC2::Client.new(region: "us-east-1")
opsworks_instances = client.describe_instances(filters: [{name: "tag-key", values: ["opsworks:instance"]}]).reservations.flat_map(&:instances)
puts opsworks_instances.map { |i| i.tags.find { |t| t.key == "opsworks:instance" }.value }.sort
